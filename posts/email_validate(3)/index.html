<!DOCTYPE html><html lang="ko-KR" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="YBUeGcldgKfDGh7GNEfhp9jWiJV6ASO69OZy4QbOTJg" /><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Spring, 이메일 인증 회원가입(3)." /><meta property="og:locale" content="ko_KR" /><meta name="description" content="기초 데이터 설정 및 이메일 서비스 연동" /><meta property="og:description" content="기초 데이터 설정 및 이메일 서비스 연동" /><link rel="canonical" href="https://angrypig123.github.io/posts/email_validate(3)/" /><meta property="og:url" content="https://angrypig123.github.io/posts/email_validate(3)/" /><meta property="og:site_name" content="화난돼지 블로그" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-03-03T15:01:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spring, 이메일 인증 회원가입(3)." /><meta name="twitter:site" content="@Angrypig123" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-03-03T15:01:00+09:00","datePublished":"2024-03-03T15:01:00+09:00","description":"기초 데이터 설정 및 이메일 서비스 연동","headline":"Spring, 이메일 인증 회원가입(3).","mainEntityOfPage":{"@type":"WebPage","@id":"https://angrypig123.github.io/posts/email_validate(3)/"},"url":"https://angrypig123.github.io/posts/email_validate(3)/"}</script><title>Spring, 이메일 인증 회원가입(3). | 화난돼지 블로그</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="화난돼지 블로그"><meta name="application-name" content="화난돼지 블로그"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://github.com/AngryPig123/angrypig123.github.io/assets/86225268/60c8eac8-a33e-455d-aae7-c7a72051c2e7" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">화난돼지 블로그</a></div><div class="site-subtitle font-italic">기록용 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Angrypig123" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/Angrypig123" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['shguddnr2','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Spring, 이메일 인증 회원가입(3).</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Spring, 이메일 인증 회원가입(3).</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/AngryPig123">angrypig back-end</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2024-03-03 15:01:00 +0900" data-toggle="tooltip" data-placement="bottom" title="Sun, Mar 3, 2024, 3:01 PM +0900" >Mar 3</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1083 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p><a href="https://angrypig123.github.io/posts/email_validate(1)/" target="\_blank">이메일_인증_회원가입(2)</a></p><ul><li>이번에 할것<ul><li>Email 서비스 연동<li>데이터 생성 API 만들기<li>유저 권한 부여 API 만들기<li><code class="language-plaintext highlighter-rouge">POST MAN</code> 문서 작성 틀 잡기<li><code class="language-plaintext highlighter-rouge">spring doc</code> 설정</ul></ul><p><br /></p><h2> Email 서비스 연동</h2><ul><li>회원가입시 이메일로 특정 키값을 보내고 해당 키를 인증하면 회원가입이 최종적으로 완료 되게 하는 서비스 구성<ul><li><a href="https://velog.io/@tjddus0302/Spring-Boot-%EB%A9%94%EC%9D%BC-%EB%B0%9C%EC%86%A1-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-Gmail" target="\_blank">발신_주체_설정_참고_포스팅</a></ul><li>google-email 설정 부분만 참고하고 나머지 기능설정은 다르게 진행<ul><li>application.properties 를 이용한 구성을 분리하여 직접 <code class="language-plaintext highlighter-rouge">@Bean</code>으로 등록</ul></ul><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>
<span class="nd">@Slf4j</span>
<span class="nd">@Configuration</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProjectConfig</span> <span class="o">{</span>

  <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.mail.service.username}"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="no">USER_NAME</span><span class="o">;</span>

  <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.mail.service.password}"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="no">PASSWORD</span><span class="o">;</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">JavaMailSender</span> <span class="nf">javaMailSender</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">JavaMailSenderImpl</span> <span class="n">mailSender</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JavaMailSenderImpl</span><span class="o">();</span>
    <span class="n">mailSender</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">"smtp.gmail.com"</span><span class="o">);</span>
    <span class="n">mailSender</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="mi">587</span><span class="o">);</span>
    <span class="n">mailSender</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="no">USER_NAME</span><span class="o">);</span>
    <span class="n">mailSender</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="no">PASSWORD</span><span class="o">);</span>
    <span class="n">mailSender</span><span class="o">.</span><span class="na">getJavaMailProperties</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"mail.smtp.starttls.enable"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">mailSender</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><h2> 작업시 필요한 데이터를 생성하기 위한 엔드 포인트 생성</h2><ul><li>유저 생성 API<li>역할 생성 API<li>권한 생성 API<li>유저에게 역할을 부여하는 API<li>역할에 권한들을 부여하는 API</ul><p><br /></p><h2> 데이터 생성 API</h2><ul><li>단순 데이터 생성<ul><li><code class="language-plaintext highlighter-rouge">insertUser(@RequestParam("size") int size)</code><ul><li>입력받은 사이즈만큼 <code class="language-plaintext highlighter-rouge">User</code> 데이터를 생성하고 생성된 <code class="language-plaintext highlighter-rouge">User</code> 리스트를 <code class="language-plaintext highlighter-rouge">UserDto</code>로 반환해서 리턴</ul><li><code class="language-plaintext highlighter-rouge">insertRoles(@RequestBody RequestBodyContainer&lt;List&lt;String&gt;&gt; roleNameList)</code><ul><li>역할 이름을 문자열 형태의 리스트로 입력받고 생성된 <code class="language-plaintext highlighter-rouge">Roles</code> 리스트를 그대로 리턴<ul><li>ToDo 추후 <code class="language-plaintext highlighter-rouge">RolesDto</code>를 반환하는것으로 수정</ul></ul><li><code class="language-plaintext highlighter-rouge">insertAuthority(@RequestBody List&lt;AuthorityDto&gt; authorityList)</code><ul><li>권한 목록을 입력받고 생성된 <code class="language-plaintext highlighter-rouge">Authority</code> 리스트를 그대로 리턴<ul><li>ToDo 추후 <code class="language-plaintext highlighter-rouge">AuthorityDto</code>를 반환하는것으로 수정</ul></ul></ul></ul><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>
<span class="nd">@Slf4j</span>
<span class="nd">@RestController</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/api/v1/init-data"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InitDataController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CommonUtilService</span> <span class="n">commonUtilService</span><span class="o">;</span>

  <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/insert-users"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="nf">insertUser</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"size"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">userList</span> <span class="o">=</span> <span class="n">commonUtilService</span><span class="o">.</span><span class="na">insertRandomUser</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"init-data controller user list = {}"</span><span class="o">,</span> <span class="n">userList</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">userList</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="nl">User:</span><span class="o">:</span><span class="n">toDto</span><span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/insert-roles"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Roles</span><span class="o">&gt;</span> <span class="nf">insertRoles</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">RequestBodyContainer</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">roleNameList</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Roles</span><span class="o">&gt;</span> <span class="n">roles</span> <span class="o">=</span> <span class="n">commonUtilService</span><span class="o">.</span><span class="na">insertRole</span><span class="o">(</span><span class="n">roleNameList</span><span class="o">.</span><span class="na">getData</span><span class="o">());</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"init-data controller roles list = {}"</span><span class="o">,</span> <span class="n">roles</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">roles</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/insert-authorities"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Authority</span><span class="o">&gt;</span> <span class="nf">insertAuthority</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">AuthorityDto</span><span class="o">&gt;</span> <span class="n">authorityList</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Authority</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="n">commonUtilService</span><span class="o">.</span><span class="na">insertAuthority</span><span class="o">(</span><span class="n">authorityList</span><span class="o">);</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"init-data controller authorities = {}"</span><span class="o">,</span> <span class="n">authorities</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">authorities</span><span class="o">;</span>
  <span class="o">}</span>


  <span class="nd">@Getter</span>
  <span class="nd">@Setter</span>
  <span class="nd">@NoArgsConstructor</span>
  <span class="nd">@AllArgsConstructor</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">RequestBodyContainer</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="no">T</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h2> 유저 역할 부여 API</h2><ul><li>해당 <code class="language-plaintext highlighter-rouge">API</code> 는 추후 서비스에 필요한 로직이라 따로 분리<ul><li><code class="language-plaintext highlighter-rouge">givePermissionToAUser(@RequestBody UserDto.GivePermission givePermission)</code><ul><li>유저의 이메일과 권한의 이름을 입력받아 유저와 권한이 둘다 존재하면 유저에 역할 연결</ul></ul></ul><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>
<span class="nd">@Slf4j</span>
<span class="nd">@RestController</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/api/v1/user"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserService</span> <span class="n">userService</span><span class="o">;</span>

  <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/give-permission"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">UserDto</span><span class="o">&gt;</span> <span class="nf">givePermissionToAUser</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">UserDto</span><span class="o">.</span><span class="na">GivePermission</span> <span class="n">givePermission</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">UserDto</span> <span class="n">userDto</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">givePermissionToAUser</span><span class="o">(</span><span class="n">givePermission</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">userDto</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
  <span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">givePermissionToAUser()</code> 구현체<ul><li><code class="language-plaintext highlighter-rouge">User</code>를 직접 반환 하려고 하면 <code class="language-plaintext highlighter-rouge">no-session</code>에러 발생 서비스단에서 리턴할 때에는 Dto로 변환하여 넘겨주자!</ul></ul><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">UserDto</span> <span class="nf">givePermissionToAUser</span><span class="o">(</span><span class="nc">UserDto</span><span class="o">.</span><span class="na">GivePermission</span> <span class="n">givePermission</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">String</span> <span class="n">userEmail</span> <span class="o">=</span> <span class="n">givePermission</span><span class="o">.</span><span class="na">getUserEmail</span><span class="o">();</span>
  <span class="nc">String</span> <span class="n">roleName</span> <span class="o">=</span> <span class="n">givePermission</span><span class="o">.</span><span class="na">getRoleName</span><span class="o">();</span>

  <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">findUser</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findUserByUserEmail</span><span class="o">(</span><span class="n">userEmail</span><span class="o">);</span>
  <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Roles</span><span class="o">&gt;</span> <span class="n">findRoles</span> <span class="o">=</span> <span class="n">rolesRepository</span><span class="o">.</span><span class="na">findRolesByRoleName</span><span class="o">(</span><span class="n">roleName</span><span class="o">);</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">findUser</span><span class="o">.</span><span class="na">isPresent</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">findRoles</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
    <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">findUser</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="nc">Roles</span> <span class="n">role</span> <span class="o">=</span> <span class="n">findRoles</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="n">user</span><span class="o">.</span><span class="na">setRoles</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
    <span class="nc">User</span> <span class="n">result</span> <span class="o">=</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"result = {}"</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">toDto</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>    <span class="c1">//  ToDO 예외 처리 부분을 구체화 한다.</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /></p><h2> POST MAN</h2><ul><li>문서 구성<ul><li>ToDO : happy, sad 케이스에 대한 폴더를 구분하여 문서화한다.</ul></ul><p><img data-proofer-ignore data-src="https://github.com/AngryPig123/AngryPig123.github.io/assets/86225268/b4d63b4e-0046-469a-8a8d-28b6f3292e47" alt="post_man" /></p><p><br /></p><h2> spring docs 설정</h2><ul><li><p><code class="language-plaintext highlighter-rouge">implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.0.2'</code> 해당 의존성 추가</p><li>스프링 시큐리티를 활성화했음으로 <code class="language-plaintext highlighter-rouge">spring docs</code>에서 지원하는 리소스를 <code class="language-plaintext highlighter-rouge">permitAll()</code>해야함. 추가적으로 <code class="language-plaintext highlighter-rouge">ignoreing()</code>에도 추가<ul><li>ToDO : <code class="language-plaintext highlighter-rouge">swagger</code>를 통해 <code class="language-plaintext highlighter-rouge">API</code>에 디테일한 설정을 추가해보자</ul><li>SecurityConfig 코드</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>
<span class="nd">@Slf4j</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebSecurityConfig</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CustomAuthenticationProvider</span> <span class="n">customAuthenticationProvider</span><span class="o">;</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="no">AUTH_WHITELIST</span> <span class="o">=</span> <span class="o">{</span>
    <span class="s">"/api/**"</span><span class="o">,</span> <span class="s">"/swagger-ui/**"</span><span class="o">,</span> <span class="s">"/api-docs"</span><span class="o">,</span> <span class="s">"/swagger-ui-custom.html"</span><span class="o">,</span>
    <span class="s">"/v3/api-docs/**"</span><span class="o">,</span> <span class="s">"/api-docs/**"</span><span class="o">,</span> <span class="s">"/swagger-ui.html"</span>
  <span class="o">};</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">defaultSecurityFilterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">http</span>
      <span class="o">.</span><span class="na">cors</span><span class="o">(</span><span class="nl">AbstractHttpConfigurer:</span><span class="o">:</span><span class="n">disable</span><span class="o">)</span>
      <span class="o">.</span><span class="na">csrf</span><span class="o">(</span><span class="nl">AbstractHttpConfigurer:</span><span class="o">:</span><span class="n">disable</span><span class="o">)</span>
      <span class="o">.</span><span class="na">authenticationProvider</span><span class="o">(</span><span class="n">customAuthenticationProvider</span><span class="o">)</span>
      <span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">(</span>
        <span class="o">(</span><span class="n">requests</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">requests</span>
          <span class="o">.</span><span class="na">requestMatchers</span><span class="o">(</span><span class="no">AUTH_WHITELIST</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
          <span class="o">.</span><span class="na">requestMatchers</span><span class="o">(</span><span class="s">"/api/v*/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
          <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">permitAll</span><span class="o">()</span>
      <span class="o">)</span>
      <span class="o">.</span><span class="na">formLogin</span><span class="o">(</span><span class="n">withDefaults</span><span class="o">())</span>
      <span class="o">.</span><span class="na">httpBasic</span><span class="o">(</span><span class="n">withDefaults</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">WebSecurityCustomizer</span> <span class="nf">webSecurityCustomizer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">web</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">web</span><span class="o">.</span><span class="na">ignoring</span><span class="o">().</span><span class="na">requestMatchers</span><span class="o">(</span><span class="no">AUTH_WHITELIST</span><span class="o">);</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://github.com/AngryPig123/AngryPig123.github.io/assets/86225268/50e6501b-9f7f-492a-82f9-1293767d1035" alt="swagger_ui" /></p><ul><li>다음에 할것<ul><li>역할_권한 중간 테이블에 데이터 넣는 <code class="language-plaintext highlighter-rouge">API</code>추가<li>토큰 인증 화면 구성(사용자에게 보내지는 메일을 꾸며주는 템플릿)<li><code class="language-plaintext highlighter-rouge">email-token</code>관련 <code class="language-plaintext highlighter-rouge">Entity</code>추가 및 <code class="language-plaintext highlighter-rouge">security</code> 인증 로직 수정</ul></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/back-end/" class="post-tag no-text-decoration" >back-end</a> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/email-sender/" class="post-tag no-text-decoration" >email sender</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spring, 이메일 인증 회원가입(3). - 화난돼지 블로그&url=https://angrypig123.github.io/posts/email_validate(3)/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spring, 이메일 인증 회원가입(3). - 화난돼지 블로그&u=https://angrypig123.github.io/posts/email_validate(3)/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Spring, 이메일 인증 회원가입(3). - 화난돼지 블로그&url=https://angrypig123.github.io/posts/email_validate(3)/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo= "AngryPig123/angrypig123.github.io" issue-term="pathname" label="✨Tester✨" theme="github-light" crossorigin="anonymous" async> </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/user_menu_authority_spring(3)/">관리자 권한, 메뉴 관리 (4)</a><li><a href="/posts/user_menu_authority/">관리자 권한, 메뉴 관리 (1)</a><li><a href="/posts/user_menu_authority_spring(1)/">관리자 권한, 메뉴 관리 (2)</a><li><a href="/posts/user_menu_authority_spring(2)/">관리자 권한, 메뉴 관리 (3)</a><li><a href="/posts/3-tier(1)/">3-tier architecture(1)</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/back-end/">back-end</a> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kocw/">kocw</a> <a class="post-tag" href="/tags/jpa/">jpa</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/email_validate(2)/"><div class="card-body"> <em class="timeago small" date="2024-03-02 19:10:00 +0900" >Mar 2</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring, 이메일 인증 회원가입(2).</h3><div class="text-muted small"><p> 이메일_인증_회원가입(1) 이번에 할것 기초 데이터 셋팅을 위한 유틸 서비스 구성 기초 데이터 셋팅을 위한 유틸 서비스 구성 프로젝트를 할때마다 기초 데이터를 셋팅하는것에 고민이 많아서 구성하게됨 랜덤하게 유저를 생성해주는 API가 있어서 openfeign으로 호출 후 필요한 ...</p></div></div></a></div><div class="card"> <a href="/posts/email_validate(4)/"><div class="card-body"> <em class="timeago small" date="2024-03-03 19:00:00 +0900" >Mar 3</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring, 이메일 인증 회원가입(4).</h3><div class="text-muted small"><p> 이메일_인증_회원가입(3) 이번에 할것 토큰 인증 화면 구성(사용자에게 보내지는 메일을 꾸며주는 템플릿) 역할_권한 중간 테이블에 데이터 넣는 API추가 JavaMailSender 수정 템플릿에 포함된 내용을 UTF-8 형식으로 인코딩 하기 위한 설정 해당 설정을 안할시 한글이 깨져...</p></div></div></a></div><div class="card"> <a href="/posts/security_csrf(2)/"><div class="card-body"> <em class="timeago small" date="2024-02-22 21:40:00 +0900" >Feb 22</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spring Security, Csrf 검증 필터</h3><div class="text-muted small"><p> Spring Security Csrf 설정중 생긴 문제 Csrf 공격 모방을 실제로 하기 힘들어 csrf test 코드 작성중 생긴 문제 perform 메소드 에서 인자로 with(csrf().asHeader().userInvalidToken())을 넘길시 상태 코드가 200으로 넘어오는 문제 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/email_validate(2)/" class="btn btn-outline-primary" prompt="Older"><p>Spring, 이메일 인증 회원가입(2).</p></a> <a href="/posts/docker(5)/" class="btn btn-outline-primary" prompt="Newer"><p>Docker(5)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/AngryPig123">angrypig back-end</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/back-end/">back-end</a> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kocw/">kocw</a> <a class="post-tag" href="/tags/jpa/">jpa</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-KDXVLQW78W"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-KDXVLQW78W'); }); </script>
